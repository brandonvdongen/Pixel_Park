!function(e){var t={};function i(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";let o,s,n;i.r(t);let a=0;function r(){o=document.createElement("div"),s=document.createElement("div"),n=document.createElement("div"),o.classList.add("preloader"),n.classList.add("progress"),s.classList.add("text"),o.appendChild(n),o.appendChild(s),document.body.appendChild(o)}function l(e){let t=0;a=0,o||r(),o.classList.remove("done");const i={};e.load.on("fileprogress",function(l,c){t=e.load.totalToLoad,function(e,t,i,l){let c;o||r();let d=0;i[e.key]=t;for(const e in i)i.hasOwnProperty(e)&&(c="Downloading ("+(a+1)+"/"+l+") "+e+":"+Math.round(100*i[e])+"%",d+=i[e],n.style.width=d/l*600+"px");s.innerText=c,d/l==1&&(s.innerText="Loading Game..."),1===t&&a++}(l,c,i,t)}.bind(this)),e.load.maxParallelDownloads=1,e.load.on("complete",function(){o.classList.add("done")})}let c,d={settings:{resolution:JSON.parse(localStorage.getItem("resolution"))||{height:600,width:800}},mainCamera:void 0,alignment:{centered:{},topLeft:{}},controls:{up:0,down:0,left:0,right:0},multiplayer:{},player:{}},p={song_witchesGetBitches:{name:"Strike Witches Get Bitches",author:"Azureflux",src:"assets/music/Azureflux_-_02_-_Strike_Witches_Get_Bitches.ogg"},song_bitBossa:{name:"Bit Bossa",author:"Azureflux",src:"assets/music/Azureflux_-_07_-_Bit_Bossa.ogg"},song_electrodoodle:{name:"Electricdoodle",author:"Kevin MacLeod",src:"assets/music/Electrodoodle.ogg"},song_chiphInstrumental:{name:"Chipho Instrumental",author:"RoccoW",src:"assets/music/RoccoW_-_Chipho_instrumental.ogg"},song_nontindeVendorTheme:{name:"Nontinde Vendor Theme",author:"RoccoW",src:"assets/music/RoccoW_-_Nontinde_Vendor_Theme.ogg"},song_XinyueTheme:{name:"Xinyue Theme 1",author:"The J Arhur Keenes Band",src:"assets/music/The_J_Arthur_Keenes_Band_-_01_-_Xinyue_Theme_1.ogg"}};function m(e,t){c&&c.destroy(),(c=e.sound.add(t)).pauseOnBlur=!1,c.volume=.05,c.loop=!0,c.play()}const h={KeyW:"up",KeyA:"left",KeyS:"down",KeyD:"right"};function u(e){if(h[e])return h[e]}let y,g,f,w,_,x=!1;function C(e,t,i){i&&e.setPosition(i.x,i.y);let o=!1;t&&e&&d.player&&(t.up?(e.setVelocityY(-100),o=!0):t.down?(e.setVelocityY(100),o=!0):e.setVelocityY(0),t.left?(e.setVelocityX(-100),o=!0):t.right?(e.setVelocityX(100),o=!0):e.setVelocityX(0),o?(e.anims.play("hop",!0),e.isMoving=!0):!o&&e.isMoving&&(e.isMoving=!1,e.anims.play("idle",!0),console.log(e,"idle")),e.position&&(e.depth=e.position.y),d.player.controls=t,d.player.position=e.position)}function v(e,t,i){const o=new T(e,t,i);let s=d.controls;return C(o.sprite,s,o.sprite.position),o.sprite.anims.play("spawn",!0),o}class T{constructor(e,t={x:100,y:100},i="#ffffff"){this.id=d.player.id,this.color=i,this.sprite=e.physics.add.sprite(16,16,"player"),this.sprite.setSize(10,10),this.sprite.setOffset(11,14),this.sprite.setPosition(t.x,t.y),this.sprite.setCollideWorldBounds(!0),this.sprite.setBounce(0),this.position=t,this.controls={up:0,down:0,left:0,right:0}}}function S(e){for(const t in d.multiplayer)if(d.multiplayer.hasOwnProperty(t)){const i=d.multiplayer[t].sprite,o=d.multiplayer[t].controls,s=e||{x:i.x,y:i.y},n=d.multiplayer[t].isMoving||!1;s&&i.setPosition(s.x,s.y),i.setVelocity(0,0);let a=!1;o&&i&&(o.up?(i.setVelocityY(-100),a=!0):o.down?(i.setVelocityY(100),a=!0):i.setVelocityY(0),o.left?(i.setVelocityX(-100),a=!0):o.right?(i.setVelocityX(100),a=!0):i.setVelocityX(0),a?(i.anims.play("hop",!0),d.multiplayer[t].isMoving=!0):!a&&n&&(d.multiplayer[t].isMoving=!1,i.anims.play("idle",!0),console.log(i,"idle")),i.depth=i.y)}}function V(){if(y){const e=JSON.parse(JSON.stringify(d.player));delete e.sprite,console.log(e),y.emit("update",e)}}function B(e,t){e&&(void 0===t&&(t=0),d.mainCamera.scrollX=t*d.mainCamera.scrollX+(1-t)*(e.x-.5*d.mainCamera.width),d.mainCamera.scrollY=t*d.mainCamera.scrollY+(1-t)*(e.y-.5*d.mainCamera.height))}let P=JSON.parse(localStorage.getItem("resolution"))||{height:600,width:800};localStorage.setItem("resolution",JSON.stringify(P));const b={type:Phaser.CANVAS,width:window.innerWidth,height:window.innerHeight,physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[class extends Phaser.Scene{constructor(){super({key:"MainMenu"})}preload(){l(this),function(e){e.load.image("player","assets/sprites/player.png"),e.load.spritesheet("player_idle","assets/sprites/player_idle.png",{frameWidth:32,frameHeight:32}),e.load.spritesheet("player_hop","assets/sprites/player_hop.png",{frameWidth:32,frameHeight:32}),e.load.spritesheet("player_spawn","assets/sprites/player_spawn.png",{frameWidth:32,frameHeight:32}),e.load.on("complete",()=>{e.anims.create({key:"idle",frames:e.anims.generateFrameNumbers("player_idle",{start:0,end:2}),frameRate:2,repeat:-1}),e.anims.create({key:"hop",frames:e.anims.generateFrameNumbers("player_hop",{start:0,end:6}),frameRate:12,repeat:-1}),e.anims.create({key:"spawn",frames:e.anims.generateFrameNumbers("player_spawn",{start:0,end:14}),frameRate:12,repeat:0,onComplete:function(e,t){console.log("done spawning"),e.anims.play("idle",!0)}.bind(this)}),e.anims.create({key:"delete",frames:e.anims.generateFrameNumbers("player_spawn",{frames:[14,13,12,11,10,9,8,7,6,5,4,3,2,1]}),frameRate:12,repeat:0,onComplete:function(e,t){console.log("deleted"),e.destroy()}.bind(this)});let t=d.controls;x||(document.addEventListener("keydown",e=>{const i=u(e.code);t[i]||void 0===i||(t[i]=1,V())}),document.addEventListener("keyup",e=>{const i=u(e.code);t[i]&&(t[i]=0,V())}),x=!0)})}(this)}create(){d.activeScene=this,this.sound.pauseOnBlur=!1,this.input.once("pointerdown",function(e){this.scene.start("PixilTown")},this),new Promise(function(e,t){(y=io("https://brandonvdongen.nl:8000")).on("connect",()=>{console.log("connecting..."),d.online?(console.log("Connection lost"),y.close()):y.emit("identify",{version:d.version,game_name:d.game_name})}),y.on("server_missmatch",()=>{console.error("your version doesn't match with the server!"),y.close(),t()}),y.on("identified",t=>{console.log("identified, login succesfull",t),t.online=!0,e(t)}),y.on("change_map",e=>{console.log(e),d.activeScene.scene.start(e.map)}),y.on("joined",e=>{console.log("joined",e),d.multiplayer[e.id]=v(d.activeScene,d.sceneSpawn,"#ffffff")}),y.on("left",e=>{d.multiplayer[e.id]&&(d.multiplayer[e.id].sprite.anims.play("delete",!0),delete d.multiplayer[e.id]),console.log("left",e)}),y.on("update",e=>{d.multiplayer[e.id]||(d.multiplayer[e.id]=v(d.activeScene,e.position,"#ffffff")),e.sprite=d.multiplayer[e.id].sprite,d.multiplayer[e.id]=e,C(e.sprite,e.controls,e.position)})}).then(e=>{d.player.id=e.id,this.scene.start(e.map)})}update(){}},class extends Phaser.Scene{constructor(){super({key:"PixilTown"})}preload(){console.log("loading map"),l(this),this.load.audio("song_XinyueTheme",p.song_XinyueTheme.src),this.load.image("PixilTown","assets/tiles/PixilTown.png"),this.load.tilemapTiledJSON("Map_PixilTown","assets/tilemap/PixilTown.json")}create(){d.activeScene=this;const e=(f=this.make.tilemap({key:"Map_PixilTown"})).addTilesetImage("PixilTown"),t=f.createStaticLayer("Ground",e,0,0),i=f.createStaticLayer("Bridge",e,0,0);f.setLayer(t),t.setCollisionBetween(9,11),t.setCollision(-1),t.setCollisionFromCollisionGroup(),i.setCollisionFromCollisionGroup(),d.mainCamera=this.cameras.main,d.mainCamera.setViewport(0,0,window.innerWidth,window.innerHeight),d.mainCamera.setZoom(3),this.sound.pauseOnBlur=!1,m(this,"song_XinyueTheme");const o=f.tileToWorldXY(2,2,{},d.mainCamera,t);o.x-=f.tileWidth/2,o.y-=f.tileHeight/2,d.sceneSpawn=o,d.player=v(this,o,"#ffffff"),this.physics.add.collider(d.player.sprite,t),this.physics.add.collider(d.player.sprite,i),d.cameraTarget=d.player.sprite,B(d.cameraTarget,0)}update(e,t){B(d.cameraTarget,.9),g=d.player.sprite;let i=d.controls;g.position={x:g.x,y:g.y},C(g,i,g.position),S()}},class extends Phaser.Scene{constructor(){super({key:"Voxalia"})}preload(){console.log("loading map"),l(this),this.load.audio("song_bitBossa",p.song_bitBossa.src),this.load.image("Voxalia","assets/tiles/Voxalia.png"),this.load.tilemapTiledJSON("Map_Voxalia","assets/tilemap/Voxalia.json")}create(){d.activeScene=this;const e=(_=this.make.tilemap({key:"Map_Voxalia"})).addTilesetImage("Voxalia"),t=_.createStaticLayer("Ground",e,0,0),i=_.createStaticLayer("Bridge",e,0,0);_.setLayer(t),t.setCollisionBetween(9,11),t.setCollision(-1),t.setCollisionFromCollisionGroup(),i.setCollisionFromCollisionGroup(),d.mainCamera=this.cameras.main,d.mainCamera.setViewport(0,0,window.innerWidth,window.innerHeight),d.mainCamera.setZoom(3),this.sound.pauseOnBlur=!1,m(this,"song_bitBossa");const o=_.tileToWorldXY(2,5,{},d.mainCamera,t);o.x-=_.tileWidth/2,o.y-=_.tileHeight/2,d.sceneSpawn=o,d.player=v(this,o,"#ffffff"),this.physics.add.collider(d.player.sprite,t),this.physics.add.collider(d.player.sprite,i),d.cameraTarget=d.player.sprite,this.matter.world.createDebugGraphic(),this.matter.world.drawDebug=!1}update(e,t){var i,o;i=d.cameraTarget,o=.9,i&&(void 0===o&&(o=0),d.mainCamera.scrollX=o*d.mainCamera.scrollX+(1-o)*(i.x-.5*d.mainCamera.width),d.mainCamera.scrollY=o*d.mainCamera.scrollY+(1-o)*(i.y-.5*d.mainCamera.height)),w=d.player.sprite;let s=d.controls;w.position={x:w.x,y:w.y},C(w,s,w.position),S()}}],pixelArt:!0},W=new Phaser.Game(b);window.onresize=function(){W.resize(window.innerWidth,window.innerHeight,1),d.mainCamera&&d.mainCamera.setViewport(0,0,window.innerWidth,window.innerHeight)},d.version=2,d.game_name="pixel_park"}]);