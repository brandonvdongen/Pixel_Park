!function(e){var t={};function i(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";let o,a,s;i.r(t);let n=0;function r(){o=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),o.classList.add("preloader"),s.classList.add("progress"),a.classList.add("text"),o.appendChild(s),o.appendChild(a),document.body.appendChild(o)}function l(e){let t=0;n=0,o||r(),o.classList.remove("done");const i={};e.load.on("fileprogress",function(l,c){t=e.load.totalToLoad,function(e,t,i,l){let c;o||r();let p=0;i[e.key]=t;for(const e in i)i.hasOwnProperty(e)&&(c="Downloading ("+(n+1)+"/"+l+") "+e+":"+Math.round(100*i[e])+"%",p+=i[e],s.style.width=p/l*600+"px");a.innerText=c,p/l==1&&(a.innerText="Loading Game..."),1===t&&n++}(l,c,i,t)}.bind(this)),e.load.maxParallelDownloads=1,e.load.on("complete",function(){o.classList.add("done")})}let c={settings:{resolution:JSON.parse(localStorage.getItem("resolution"))||{height:600,width:800}},mainCamera:void 0,alignment:{centered:{},topLeft:{}},controls:{up:0,down:0,left:0,right:0,interact:0},multiplayer:{},player:{}},p={song_witchesGetBitches:{name:"Strike Witches Get Bitches",author:"Azureflux",src:"assets/music/Azureflux_-_02_-_Strike_Witches_Get_Bitches.ogg"},song_bitBossa:{name:"Bit Bossa",author:"Azureflux",src:"assets/music/Azureflux_-_07_-_Bit_Bossa.ogg"},song_electrodoodle:{name:"Electricdoodle",author:"Kevin MacLeod",src:"assets/music/Electrodoodle.ogg"},song_chiphInstrumental:{name:"Chipho Instrumental",author:"RoccoW",src:"assets/music/RoccoW_-_Chipho_instrumental.ogg"},song_nontindeVendorTheme:{name:"Nontinde Vendor Theme",author:"RoccoW",src:"assets/music/RoccoW_-_Nontinde_Vendor_Theme.ogg"},song_XinyueTheme:{name:"Xinyue Theme 1",author:"The J Arhur Keenes Band",src:"assets/music/The_J_Arthur_Keenes_Band_-_01_-_Xinyue_Theme_1.ogg"}};const d={KeyW:"up",KeyA:"left",KeyS:"down",KeyD:"right",KeyE:"interact"};function m(e){if(d[e])return d[e]}let h=!1;function u(e,t,i){void 0===t&&(t=e.map.spawn);const o=new y(e,t,i);if(e.map.layers.forEach(t=>{e.physics.add.collider(o.sprite,t.tilemapLayer)}),o.sprite.anims.play("spawn",!0),!h){const e=o.controls;document.addEventListener("keydown",t=>{const i=m(t.code);e[i]||void 0===i||(e[i]=1)}),document.addEventListener("keyup",t=>{const i=m(t.code);e[i]&&(e[i]=0)}),h=!0}return o}class y{constructor(e,t,i="#ffffff"){this.color=i,this.sprite=e.physics.add.sprite(16,16,"player"),this.sprite.setSize(10,10),this.sprite.setOffset(11,11),this.sprite.setPosition(t.x,t.y),this.sprite.setCollideWorldBounds(!0),this.sprite.setBounce(0),this.position=t,this.controls={up:0,down:0,left:0,right:0,interact:0}}}let g=!1;let f,w=!1;function _(e,t,i){if("load_map"===i)e.load.tilemapTiledJSON(t.name,t.src);else for(const o in t)t.hasOwnProperty(o)&&("load_image"===i?e.load.image(o,t[o]):"load_audio"===i&&e.load.audio(o,t[o]))}function x(e){!function(e){const t=e.map;w||((f=e.add.graphics()).lineStyle(3,16777215,1),f.strokeRect(0,0,t.tileWidth,t.tileHeight),w=!0);const i=e.input.activePointer.positionToCamera(e.cameras.main),o=t.worldToTileX(i.x),a=t.worldToTileY(i.y);f.x=t.tileToWorldX(o),f.y=t.tileToWorldY(a),e.input.manager.activePointer.isDown&&!g?(g=!0,t.layers.forEach(e=>{t.setLayer(e.name);const i=t.getTileAt(o,a);i&&console.log("Properties: ",i.properties)})):!e.input.manager.activePointer.isDown&&g&&(g=!1)}(e)}const T="PixilTown",C={map:{name:T,src:"assets/tilemap/PixilTown.json",layers:[{name:"Ground",key:"Tiles_PixilTown"},{name:"Roof",key:"Tiles_PixilTown"}]},images:{Tiles_PixilTown:"assets/tiles/PixilTown.png"},audio:{song_XinyueTheme:p.song_XinyueTheme.src},transport:[{name:"Voxalia",position:{x:21,y:7},target:{map:"Voxalia",destination:"PixilTown"}}]};let P,V,v;let k=JSON.parse(localStorage.getItem("resolution"))||{height:600,width:800};localStorage.setItem("resolution",JSON.stringify(k));const W={type:Phaser.CANVAS,width:window.innerWidth,height:window.innerHeight,physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[class extends Phaser.Scene{constructor(){super({key:"MainMenu"})}preload(){var e;l(this),this.load.audio("song_nontindeVendorTheme",p.song_nontindeVendorTheme.src),this.load.image("menu_main","assets/textures/hud/mainmenu.png"),(e=this).load.image("player","assets/sprites/player.png"),e.load.spritesheet("player_idle","assets/sprites/player_idle.png",{frameWidth:32,frameHeight:32}),e.load.spritesheet("player_hop","assets/sprites/player_hop.png",{frameWidth:32,frameHeight:32}),e.load.spritesheet("player_spawn","assets/sprites/player_spawn.png",{frameWidth:32,frameHeight:32}),e.load.on("complete",()=>{e.anims.create({key:"idle",frames:e.anims.generateFrameNumbers("player_idle",{start:0,end:2}),frameRate:2,repeat:-1}),e.anims.create({key:"hop",frames:e.anims.generateFrameNumbers("player_hop",{start:0,end:6}),frameRate:12,repeat:-1}),e.anims.create({key:"spawn",frames:e.anims.generateFrameNumbers("player_spawn",{start:0,end:14}),frameRate:12,repeat:0,onComplete:function(e){console.log("player spawned"),e.anims.play("idle")}}),e.anims.create({key:"delete",frames:e.anims.generateFrameNumbers("player_spawn",{frames:[14,13,12,11,10,9,8,7,6,5,4,3,2,1,0]}),frameRate:12,repeat:0,onComplete:function(e){e.destroy()}})})}create(){c.activeScene=this,this.sound.pauseOnBlur=!1,console.log("starting"),this.scene.start("PixilTown")}update(){}},class extends Phaser.Scene{constructor(){super({key:T})}preload(){var e,t;l(this),e=this,t=C,console.log("loading plugins"),e.load.plugin("AnimatedTiles","./plugins/AnimatedTiles.min.js"),console.log("loading map"),t.map&&_(e,t.map,"load_map"),t.images&&_(e,t.images,"load_image"),t.audio&&_(e,t.audio,"load_audio")}create(){this.map=function(e,t){console.log("installing plugins"),e.sys.install("AnimatedTiles"),console.log("setting up camera");const i=e.cameras.main;i.setViewport(0,0,window.innerWidth,window.innerHeight),i.setZoom(3),console.log("creating map");const o=e.make.tilemap({key:t.map.name});t.map.layers.forEach((e,t)=>{const i=o.addTilesetImage(e.key);let a=o.createDynamicLayer(e.name,i,0,0);a.setCollisionByProperty({collides:!0}),a.depth=0===t?0:1e3});const a=o.getLayer("Ground");return console.log("getting tile data"),o.getTilesWithin(0,0,a.width,a.height,{},a.tilemapLayer).forEach((e,s)=>{if(e.properties&&(e.properties.spawn&&(console.log("found spawn"),o.spawn=o.tileToWorldXY(e.x+1,e.y+1,{},i,a.tilemapLayer),o.spawn.x-=o.tileWidth/2,o.spawn.y-=o.tileHeight/2),!0===e.properties.teleporter)){let i=!1;t.transport.forEach(t=>{t.position.x===e.x&&t.position.y===e.y&&(i=!0,console.log("found transporter:",t.name),e.properties.map=t.target.map,e.properties.destination=t.target.destination,o.teleporters||(o.teleporters={}),o.teleporters[t.name]=t),i||console.warn("transport ",t,"configured, but no teleporter tile found at specified position")})}}),console.log("map loaded"),e.sys.animatedTiles.init(o),o}(this,C),this.player=u(this,void 0,"#ffffff"),this.player.you=!0,function(e,t){const i=e.cameras.main;i.scrollX=i.scrollX+(t.x-.5*i.width),i.scrollY=i.scrollY+(t.y-.5*i.height)}(this,this.player.sprite)}update(e,t){!function(e,t){if(e.cameraTarget){void 0===t&&(t=0);const i=e.cameras.main,o=e.cameraTarget;i.scrollX=t*i.scrollX+(1-t)*(o.x-.5*i.width),i.scrollY=t*i.scrollY+(1-t)*(o.y-.5*i.height)}else e.cameraTarget=e.player.sprite}(this,.9),x(this),function(e,t,i){let o=!1;const a=e.player.sprite;if(t&&a){if(t.up?(a.setVelocityY(-100),o=!0):t.down?(a.setVelocityY(100),o=!0):a.setVelocityY(0),t.left?(a.setVelocityX(-100),o=!0):t.right?(a.setVelocityX(100),o=!0):a.setVelocityX(0),o?(a.anims.play("hop",!0),a.walking=!0):!0===a.walking&&(a.anims.play("idle",!0),a.walking=!1,i&&a.setPosition(i.x,i.y)),!o&&i){const t=e.map,o=(t.getLayer("Ground"),t.worldToTileXY(i.x,i.y)),s=t.tileToWorldXY(o.x,o.y),n=.1;t.layers.forEach(e=>{t.setLayer(e.name);const r=t.getTileAt(o.x,o.y);if(r&&!0===r.properties.align){const t={x:(i.x-s.x-e.baseTileWidth/2)*n,y:(i.y-s.y-e.baseTileHeight/2)*n};a.setPosition(i.x-t.x,i.y-t.y)}})}a.position&&(a.depth=a.position.y)}}(this,this.player.controls,this.player.sprite)}},class extends Phaser.Scene{constructor(){super({key:"Voxalia"})}preload(){console.log("loading map"),l(this),this.load.audio("song_bitBossa",p.song_bitBossa.src),this.load.image("Voxalia","assets/tiles/Voxalia.png"),this.load.tilemapTiledJSON("Map_Voxalia","assets/tilemap/Voxalia.json")}create(){c.activeScene=this;const e=(v=this.make.tilemap({key:"Map_Voxalia"})).addTilesetImage("Voxalia"),t=v.createStaticLayer("Ground",e,0,0),i=v.createStaticLayer("Bridge",e,0,0);var o,a;t.setCollisionBetween(9,11),t.setCollision(-1),t.setCollisionFromCollisionGroup(),i.setCollisionFromCollisionGroup(),c.mainCamera=this.cameras.main,c.mainCamera.setViewport(0,0,window.innerWidth,window.innerHeight),c.mainCamera.setZoom(3),this.sound.pauseOnBlur=!1,o=this,a="song_bitBossa",P&&P.destroy(),(P=o.sound.add(a)).pauseOnBlur=!1,P.volume=.05,P.loop=!0,P.play(),v.spawn=v.tileToWorldXY(2,5,{},c.mainCamera,t),v.spawn.x-=v.tileWidth/2,v.spawn.y-=v.tileHeight/2,c.sceneSpawn=v,c.player=u(this,v,"#ffffff"),console.log(t),c.cameraTarget=c.player.sprite,v.setLayer(0),function(e,t){i&&(i.clear(),i.destroy());const i=e.add.graphics(),o=new Phaser.Display.Color(105,210,231,200),a=new Phaser.Display.Color(243,134,48,200),s=new Phaser.Display.Color(40,39,37,255);i.clear(),t.renderDebug(i,{tileColor:o,collidingTileColor:a,faceColor:s})}(this,v)}update(e,t){var i,o;i=c.cameraTarget,o=.9,i&&(void 0===o&&(o=0),c.mainCamera.scrollX=o*c.mainCamera.scrollX+(1-o)*(i.x-.5*c.mainCamera.width),c.mainCamera.scrollY=o*c.mainCamera.scrollY+(1-o)*(i.y-.5*c.mainCamera.height)),V=c.player.sprite;let a=c.controls;V.position={x:V.x,y:V.y},(void 0)(V,a,V.position),function(e){for(const t in c.multiplayer)if(c.multiplayer.hasOwnProperty(t)){const i=c.multiplayer[t].sprite,o=c.multiplayer[t].controls,a=e||{x:i.x,y:i.y};a&&i.setPosition(a.x,a.y),i.setVelocity(0,0);let s=!1;o&&i&&(o.up?(i.setVelocityY(-100),s=!0):o.down?(i.setVelocityY(100),s=!0):i.setVelocityY(0),o.left?(i.setVelocityX(-100),s=!0):o.right?(i.setVelocityX(100),s=!0):i.setVelocityX(0),s?(i.anims.play("hop",!0),i.walking=!0):!0===i.walking&&(i.anims.play("idle",!0),i.walking=!1),i.position&&(i.depth=i.position.y))}}()}}],pixelArt:!0},X=new Phaser.Game(W);window.onresize=function(){X.resize(window.innerWidth,window.innerHeight,1),X.cameras.main&&X.cameras.main.setViewport(0,0,window.innerWidth,window.innerHeight)},c.version=2,c.game_name="pixel_park"}]);