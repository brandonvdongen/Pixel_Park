!function(e){var t={};function i(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";let a,o,s;i.r(t);let n=0;function r(){a=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),a.classList.add("preloader"),s.classList.add("progress"),o.classList.add("text"),a.appendChild(s),a.appendChild(o),document.body.appendChild(a)}function l(e){let t=0;n=0,a||r(),a.classList.remove("done");const i={};e.load.on("fileprogress",function(l,c){t=e.load.totalToLoad,function(e,t,i,l){let c;a||r();let p=0;i[e.key]=t;for(const e in i)i.hasOwnProperty(e)&&(c="Downloading ("+(n+1)+"/"+l+") "+e+":"+Math.round(100*i[e])+"%",p+=i[e],s.style.width=p/l*600+"px");o.innerText=c,p/l==1&&(o.innerText="Loading Game..."),1===t&&n++}(l,c,i,t)}.bind(this)),e.load.maxParallelDownloads=1,e.load.on("complete",function(){a.classList.add("done")})}let c,p={settings:{resolution:JSON.parse(localStorage.getItem("resolution"))||{height:600,width:800}},mainCamera:void 0,alignment:{centered:{},topLeft:{}},controls:{up:0,down:0,left:0,right:0},multiplayer:{},player:{}},d={song_witchesGetBitches:{name:"Strike Witches Get Bitches",author:"Azureflux",src:"assets/music/Azureflux_-_02_-_Strike_Witches_Get_Bitches.ogg"},song_bitBossa:{name:"Bit Bossa",author:"Azureflux",src:"assets/music/Azureflux_-_07_-_Bit_Bossa.ogg"},song_electrodoodle:{name:"Electricdoodle",author:"Kevin MacLeod",src:"assets/music/Electrodoodle.ogg"},song_chiphInstrumental:{name:"Chipho Instrumental",author:"RoccoW",src:"assets/music/RoccoW_-_Chipho_instrumental.ogg"},song_nontindeVendorTheme:{name:"Nontinde Vendor Theme",author:"RoccoW",src:"assets/music/RoccoW_-_Nontinde_Vendor_Theme.ogg"},song_XinyueTheme:{name:"Xinyue Theme 1",author:"The J Arhur Keenes Band",src:"assets/music/The_J_Arthur_Keenes_Band_-_01_-_Xinyue_Theme_1.ogg"}};const m={KeyW:"up",KeyA:"left",KeyS:"down",KeyD:"right"};function u(e){if(m[e])return m[e]}let h,y,g=!1;function f(e,t,i){let a=!1;i&&e.setPosition(i.x,i.y),t&&e&&p.player&&(t.up?(e.setVelocityY(-100),a=!0):t.down?(e.setVelocityY(100),a=!0):e.setVelocityY(0),t.left?(e.setVelocityX(-100),a=!0):t.right?(e.setVelocityX(100),a=!0):e.setVelocityX(0),a?(e.anims.play("hop",!0),e.walking=!0):!0===e.walking&&(e.anims.play("idle",!0),e.walking=!1,i&&e.setPosition(i.x,i.y)),e.position&&(e.depth=e.position.y),p.player.controls=t,p.player.position=e.position)}function w(e,t,i){const a=new _(e,t,i);let o=p.controls;return f(a.sprite,o,a.sprite.position),a.sprite.anims.play("spawn",!0),a}class _{constructor(e,t={spawn:{x:100,y:100}},i="#ffffff"){this.id=p.player.id,this.color=i,this.sprite=e.physics.add.sprite(16,16,"player"),this.sprite.setSize(10,10),this.sprite.setOffset(11,14),this.sprite.setPosition(t.spawn.x,t.spawn.y),this.sprite.setCollideWorldBounds(!0),this.sprite.setBounce(0),t.layers.forEach(t=>{e.physics.add.collider(this.sprite,t.tilemapLayer)}),this.position=origin,this.controls={up:0,down:0,left:0,right:0}}}function x(e){for(const t in p.multiplayer)if(p.multiplayer.hasOwnProperty(t)){const i=p.multiplayer[t].sprite,a=p.multiplayer[t].controls,o=e||{x:i.x,y:i.y};o&&i.setPosition(o.x,o.y),i.setVelocity(0,0);let s=!1;a&&i&&(a.up?(i.setVelocityY(-100),s=!0):a.down?(i.setVelocityY(100),s=!0):i.setVelocityY(0),a.left?(i.setVelocityX(-100),s=!0):a.right?(i.setVelocityX(100),s=!0):i.setVelocityX(0),s?(i.anims.play("hop",!0),i.walking=!0):!0===i.walking&&(i.anims.play("idle",!0),i.walking=!1),i.position&&(i.depth=i.position.y))}}function C(){if(h){const e=JSON.parse(JSON.stringify(p.player));delete e.sprite,h.emit("update",e)}}const T={};function v(e,t,i){if("load_map"===i)e.load.tilemapTiledJSON(t.name,t.src);else for(const a in t)t.hasOwnProperty(a)&&("load_image"===i?e.load.image(a,t[a]):"load_audio"===i&&e.load.audio(a,t[a]))}let P,S,k,V=!1;const W={map:{name:"Map_PixilTown",src:"assets/tilemap/PixilTown.json",layers:[{name:"Ground",key:"Tiles_PixilTown"},{name:"Bridge",key:"Tiles_PixilTown"}]},images:{Tiles_PixilTown:"assets/tiles/PixilTown.png"},audio:{song_XinyueTheme:d.song_XinyueTheme.src}};let B,X;let b=JSON.parse(localStorage.getItem("resolution"))||{height:600,width:800};localStorage.setItem("resolution",JSON.stringify(b));const O={type:Phaser.CANVAS,width:window.innerWidth,height:window.innerHeight,physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[class extends Phaser.Scene{constructor(){super({key:"MainMenu"})}preload(){var e;l(this),(e=this).load.image("player","assets/sprites/player.png"),e.load.spritesheet("player_idle","assets/sprites/player_idle.png",{frameWidth:32,frameHeight:32}),e.load.spritesheet("player_hop","assets/sprites/player_hop.png",{frameWidth:32,frameHeight:32}),e.load.spritesheet("player_spawn","assets/sprites/player_spawn.png",{frameWidth:32,frameHeight:32}),e.load.on("complete",()=>{e.anims.create({key:"idle",frames:e.anims.generateFrameNumbers("player_idle",{start:0,end:2}),frameRate:2,repeat:-1}),e.anims.create({key:"hop",frames:e.anims.generateFrameNumbers("player_hop",{start:0,end:6}),frameRate:12,repeat:-1}),e.anims.create({key:"spawn",frames:e.anims.generateFrameNumbers("player_spawn",{start:0,end:14}),frameRate:12,repeat:0,onComplete:function(e){console.log("player spawned")}}),e.anims.create({key:"delete",frames:e.anims.generateFrameNumbers("player_spawn",{frames:[14,13,12,11,10,9,8,7,6,5,4,3,2,1,0]}),frameRate:12,repeat:0,onComplete:function(e){e.destroy()}});let t=p.controls;g||(document.addEventListener("keydown",e=>{const i=u(e.code);t[i]||void 0===i||(t[i]=1,C())}),document.addEventListener("keyup",e=>{const i=u(e.code);t[i]&&(t[i]=0,C())}),g=!0)})}create(){p.activeScene=this,this.sound.pauseOnBlur=!1,this.input.once("pointerdown",function(e){this.scene.start("PixilTown")},this),new Promise(function(e,t){(h=io("https://brandonvdongen.nl:8000")).on("connect",()=>{console.log("connecting..."),p.online?(console.log("Connection lost"),h.close()):h.emit("identify",{version:p.version,game_name:p.game_name})}),h.on("server_missmatch",()=>{console.error("your version doesn't match with the server!"),h.close(),t()}),h.on("identified",t=>{console.log("identified, login succesfull",t),t.online=!0,e(t)}),h.on("change_map",e=>{p.activeScene.scene.start(e.map)}),h.on("joined",e=>{console.log("joined",e),p.multiplayer[e.id]=w(p.activeScene,p.sceneSpawn,"#ffffff"),p.multiplayer[e.id].sprite.anims.play("spawn",!0)}),h.on("left",e=>{p.multiplayer[e.id]&&(p.multiplayer[e.id].sprite.anims.play("delete",!0),delete p.multiplayer[e.id]),console.log("left",e)}),h.on("update",e=>{p.multiplayer[e.id]||(p.multiplayer[e.id]=w(p.activeScene,e.position,"#ffffff")),e.sprite=p.multiplayer[e.id].sprite,p.multiplayer[e.id]=e,f(e.sprite,e.controls,e.position)})}).then(e=>{p.player.id=e.id,this.scene.start(e.map)})}update(){}},class extends Phaser.Scene{constructor(){super({key:"PixilTown"})}preload(){var e,t;l(this),e=this,t=W,console.log("loading map"),t.map&&v(e,t.map,"load_map"),t.images&&v(e,t.images,"load_image"),t.audio&&v(e,t.audio,"load_audio")}create(){var e,t;p.activeScene=this,e=this,t=W,console.log("setting up camera"),p.mainCamera=e.cameras.main,p.mainCamera.setViewport(0,0,window.innerWidth,window.innerHeight),p.mainCamera.setZoom(3),console.log("creating map"),y=e.make.tilemap({key:t.map.name}),t.map.layers.forEach((e,t)=>{const i=y.addTilesetImage(e.key);T[e.name]=y.createStaticLayer(e.name,i,0,0),T[e.name].setCollisionByProperty({collides:!0}),T[e.name].depth=0===t?0:1e3}),y.spawn=y.tileToWorldXY(2,5,{},p.mainCamera,T.Ground),(k=y).spawn.x-=k.tileWidth/2,k.spawn.y-=k.tileHeight/2,p.sceneSpawn=k,p.player=w(this,k,"#ffffff"),p.cameraTarget=p.player.sprite,k.setLayer("Ground"),console.log(k.layer)}update(e,t){var i,a;!function(e,t){V||((P=e.add.graphics()).lineStyle(3,16777215,1),P.strokeRect(0,0,t.tileWidth,t.tileHeight),V=!0);const i=e.input.activePointer.positionToCamera(e.cameras.main),a=t.worldToTileX(i.x),o=t.worldToTileY(i.y);if(P.x=t.tileToWorldX(a),P.y=t.tileToWorldY(o),e.input.manager.activePointer.isDown){const e=t.getTileAt(a,o);e&&console.log("Properties: ",e.properties)}}(this,k),i=p.cameraTarget,a=.9,i&&(void 0===a&&(a=0),p.mainCamera.scrollX=a*p.mainCamera.scrollX+(1-a)*(i.x-.5*p.mainCamera.width),p.mainCamera.scrollY=a*p.mainCamera.scrollY+(1-a)*(i.y-.5*p.mainCamera.height)),S=p.player.sprite;let o=p.controls;S.position={x:S.x,y:S.y},f(S,o,S.position),x()}},class extends Phaser.Scene{constructor(){super({key:"Voxalia"})}preload(){console.log("loading map"),l(this),this.load.audio("song_bitBossa",d.song_bitBossa.src),this.load.image("Voxalia","assets/tiles/Voxalia.png"),this.load.tilemapTiledJSON("Map_Voxalia","assets/tilemap/Voxalia.json")}create(){p.activeScene=this;const e=(X=this.make.tilemap({key:"Map_Voxalia"})).addTilesetImage("Voxalia"),t=X.createStaticLayer("Ground",e,0,0),i=X.createStaticLayer("Bridge",e,0,0);var a,o;t.setCollisionBetween(9,11),t.setCollision(-1),t.setCollisionFromCollisionGroup(),i.setCollisionFromCollisionGroup(),p.mainCamera=this.cameras.main,p.mainCamera.setViewport(0,0,window.innerWidth,window.innerHeight),p.mainCamera.setZoom(3),this.sound.pauseOnBlur=!1,a=this,o="song_bitBossa",c&&c.destroy(),(c=a.sound.add(o)).pauseOnBlur=!1,c.volume=.05,c.loop=!0,c.play(),X.spawn=X.tileToWorldXY(2,5,{},p.mainCamera,t),X.spawn.x-=X.tileWidth/2,X.spawn.y-=X.tileHeight/2,p.sceneSpawn=X,p.player=w(this,X,"#ffffff"),console.log(t),p.cameraTarget=p.player.sprite,X.setLayer(0),function(e,t){i&&(i.clear(),i.destroy());const i=e.add.graphics(),a=new Phaser.Display.Color(105,210,231,200),o=new Phaser.Display.Color(243,134,48,200),s=new Phaser.Display.Color(40,39,37,255);i.clear(),t.renderDebug(i,{tileColor:a,collidingTileColor:o,faceColor:s})}(this,X)}update(e,t){var i,a;i=p.cameraTarget,a=.9,i&&(void 0===a&&(a=0),p.mainCamera.scrollX=a*p.mainCamera.scrollX+(1-a)*(i.x-.5*p.mainCamera.width),p.mainCamera.scrollY=a*p.mainCamera.scrollY+(1-a)*(i.y-.5*p.mainCamera.height)),B=p.player.sprite;let o=p.controls;B.position={x:B.x,y:B.y},f(B,o,B.position),x()}}],pixelArt:!0},L=new Phaser.Game(O);window.onresize=function(){L.resize(window.innerWidth,window.innerHeight,1),p.mainCamera&&p.mainCamera.setViewport(0,0,window.innerWidth,window.innerHeight)},p.version=2,p.game_name="pixel_park"}]);